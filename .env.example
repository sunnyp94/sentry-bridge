# Alpaca Market Data API — get keys from https://alpaca.markets (use Paper Trading / Sandbox for now)
APCA_API_KEY_ID=your_key_id
APCA_API_SECRET_KEY=your_secret_key

# Paper trading keys work with the main data API. Leave unset or set to:
# ALPACA_DATA_BASE_URL=https://data.alpaca.markets
# (data.sandbox.alpaca.markets is for broker partners only.)
# Data feed: default is sip (full US consolidated). Set to iex for free tier.
ALPACA_DATA_FEED=sip

# -----------------------------------------------------------------------------
# Universe / daily opportunity pool (no need to list individual stocks when using scanner)
# -----------------------------------------------------------------------------
# Set SCREENER_UNIVERSE: r2000_sp500_nasdaq100 (default) | lab_12 | russell2000 | sp500 | sp400 | nasdaq100 | alpaca_equity_500 | file:path
# Default r2000_sp500_nasdaq100 needs data/r2000.txt, data/sp500.txt, data/nasdaq100.txt (one symbol per line; get lists from FTSE Russell, S&P, Nasdaq or broker). Use lab_12 for quick tests without those files.
# SCREENER_UNIVERSE=r2000_sp500_nasdaq100
# SCREENER_TOP_N=5
# ACTIVE_SYMBOLS_FILE=data/active_symbols.txt
# OPPORTUNITY_ENGINE_ENABLED=true
# SCREENER_RUN_AT_ET=09:30
# SCREENER_Z_THRESHOLD=1.2
# SCREENER_VOLUME_SPIKE_PCT=10
# SCREENER_LOOKBACK_DAYS=35
# SCREENER_CHUNK_SIZE=100
# SCREENER_CHUNK_DELAY_SEC=0.5
# SCREENER_PARALLEL_CHUNKS=4   # fetch 4 chunks at a time (faster; 1 = sequential)
# TRADE_PAPER=true

# Two-Stage Intelligence: Discovery (7:00–9:30 ET) → Execution (9:30+)
# When DISCOVERY_ENABLED=true: start container once (e.g. 8am ET). Entrypoint runs discovery every 5 min until 9:30, then starts the engine with the handoff list.
# DISCOVERY_ENABLED=true
# DISCOVERY_START_ET=07:00
# DISCOVERY_END_ET=09:30
# DISCOVERY_INTERVAL_MIN=5
# DISCOVERY_TOP_N=10
# TWO_STAGE_ENTRY_ATR_BELOW_VWAP=1.0
# SCALE_OUT_50_AT_VWAP=true
# PORTFOLIO_HEALTH_CHECK_ET=16:00

# Brain (closest to data): Go pipes events to this process via stdin. Run from project root.
# BRAIN_CMD="python3 python-brain/apps/consumer.py"

# Logging: stderr + file. LOG_LEVEL=INFO (default); LOG_FILE=data/app.log (default, set to "" to disable file).
# LOG_FILE=data/app.log
# LOG_LEVEL=INFO

# Optional: strategy tuning. All config in python-brain/brain/config.py; .env overrides.
# Flat on startup: close all positions at market open (09:30 ET) before execution; default 09:30 in code (no .env needed). Set FLAT_POSITIONS_AT_ET= to empty for immediate flat on first event.
# FLAT_POSITIONS_ON_STARTUP=true
# Daily cap: no new buys when daily PnL >= target (let winners run; set FLAT_WHEN_DAILY_TARGET_HIT=true to also close all)
# DAILY_PROFIT_TARGET_PCT=0.25
# FLAT_WHEN_DAILY_TARGET_HIT=false
# TAKE_PROFIT_PCT=5.0
# Robustness (forward-looking edge): VOL_MAX_FOR_ENTRY, BREAKEVEN_ACTIVATION_PCT, TRAILING_STOP_*, MAX_HOLD_DAYS
# Three Pillars: Risk First (sizing), Context (regime), Signal (Z/OFI)
# Buy size: ALWAYS 5% of account equity (no safeguards, no SPY/conviction/correlation multipliers).
# POSITION_SIZE_PCT=0.05   # 5% per buy (default). STRATEGY_MAX_QTY caps shares per order.
# RISK_PCT_PER_TRADE=0     # backtest only; live ignores (no ATR sizing)
# KELLY_SIZING_ENABLED=false
# CORRELATION_CHECK_ENABLED=false  # live consumer does not reduce size for correlation
# REGIME_FILTER_ENABLED=false
# SPY 200 MA: does NOT affect buy size in live (buy always 5% equity).
# SPY_200MA_REGIME_ENABLED=false
# SPY_BELOW_200MA_Z_TIGHTEN=-2.8
# SPY_BELOW_200MA_LONG_SIZE_MULTIPLIER=0.5   # backtest only; live ignores
# DAILY_DRAWDOWN_CIRCUIT_BREAKER_PCT=5
# SCALE_OUT_ENABLED=false
# SCALE_OUT_LEVELS_PCT=1,2,3
# SCALE_OUT_PCT_PER_LEVEL=25
# VOL_MAX_FOR_ENTRY=0.55
# BREAKEVEN_ACTIVATION_PCT=1.0
# TRAILING_STOP_ACTIVATION_PCT=2.0
# TRAILING_STOP_PCT=1.0
# MAX_HOLD_DAYS=10
# TAKE_PROFIT_PCT=3.0   # lock in gains at 3% (0=off)
# TREND_FILTER_ENABLED=true   # only long when price > SMA(20)
# TREND_SMA_PERIOD=20
# Technical = RSI + MACD + 3 patterns only (double top, inverted H&S, bull/bear flag)
# USE_TECHNICAL_INDICATORS=true
# RSI_PERIOD=14
# USE_MACD=true
# MACD_FAST=12
# MACD_SLOW=26
# MACD_SIGNAL=9
# USE_PATTERNS=true
# PATTERN_LOOKBACK=40
# -----------------------------------------------------------------------------
# Few trades? Defaults are strict (quality over quantity). To allow more entries, try:
#   CONSENSUS_MIN_SOURCES_POSITIVE=1     # was 2 of 3 (news/social/momentum)
#   TWO_STAGE_ENTRY_ATR_BELOW_VWAP=0.5   # was 1.0 (allow smaller pullback below VWAP)
#   SENTIMENT_BUY_MIN_CONFIDENCE=0.10    # was 0.18
#   USE_CONSENSUS=false                  # skip consensus (single-signal buys)
# Sells: EXIT_ONLY_STOP_AND_TP=true means only stop/TP/VWAP/trailing (no sentiment exit) — by design.
# -----------------------------------------------------------------------------
# Pro mean reversion (defaults): VWAP = fair value; only long when below VWAP; TP at VWAP; 20-period ATR stop 2×; Z < -2.5 + OFI
# USE_ATR_STOP=true           # never fixed % stop — 2.0× ATR below entry (anti-shakeout)
# ATR_PERIOD=20               # 20-period ATR per spec
# ATR_STOP_MULTIPLE=2.0       # exit immediately if price hits this floor
# USE_VWAP_ANCHOR=true        # only long when price significantly below VWAP; primary target = return to VWAP
# VWAP_LONG_ONLY_BELOW=true   # do not enter at VWAP
# TAKE_PROFIT_AT_VWAP=true    # primary profit target = daily VWAP
# BREAKEVEN_AT_HALFWAY_TO_VWAP=true   # at 50% of way to VWAP, move stop to breakeven
# TRAILING_ATR_ABOVE_VWAP=true        # above VWAP: trailing stop at 1.5× ATR below peak (let winners run)
# TRAILING_ATR_MULTIPLE=1.5
# USE_ZSCORE_MEAN_REVERSION=true      # buy trigger when Z <= -2.5 (extreme move)
# ZSCORE_TRIGGER_ENTRY=-2.5
# USE_OFI=true                # after Z met, wait for OFI positive (aggressive buyers)
# OVERNIGHT_CARRY_ENABLED=true # at 4pm close only losers; winners run (trailing ATR / gap-up potential)
# CLOSE_LOSSES_BY_ET=15:50
# ZSCORE_PERIOD=20
# OFI (Order Flow Imbalance) from Alpaca trade/quote stream (Go → brain). Aggressor inferred from trade vs bid/ask.
# USE_OFI=true
# OFI_WINDOW_TRADES=100
# Session: no new buys after 3:45pm ET (positions may be held overnight)
# NO_NEW_BUYS_AFTER_ET=15:45
# USE_LIMIT_ORDERS is always true (not read from env)
# LIMIT_ORDER_OFFSET_BPS=5
# DRAWDOWN_HALT_ENABLED=true
# MAX_DRAWDOWN_PCT=2.0

# Backtest accuracy: fill at next bar open (no look-ahead), optional commission/slippage
# BACKTEST_FILL_AT_NEXT_OPEN=true
# BACKTEST_COMMISSION_PER_TRADE=0
# BACKTEST_SLIPPAGE_BPS=0

# How often to fetch positions/orders from Alpaca (seconds, 5–300; default 15 for production-like paper)
# POSITIONS_INTERVAL_SEC=15

# Experience buffer: entry/exit snapshots for strategy_optimizer. 0 = no limit (file grows forever).
# Set to e.g. 100000 to keep last 100k lines; conviction still learns from in-memory last 100 per setup.
# EXPERIENCE_BUFFER_ENABLED=true
# EXPERIENCE_BUFFER_MAX_LINES=0
# EXPERIENCE_BUFFER_PATH=

# Alpaca Trading API base URL (for positions + open orders; default paper)
# APCA_API_BASE_URL=https://paper-api.alpaca.markets
