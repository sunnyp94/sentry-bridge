# Alpaca Market Data API — get keys from https://alpaca.markets (use Paper Trading / Sandbox for now)
APCA_API_KEY_ID=your_key_id
APCA_API_SECRET_KEY=your_secret_key

# Paper trading keys work with the main data API. Leave unset or set to:
# ALPACA_DATA_BASE_URL=https://data.alpaca.markets
# (data.sandbox.alpaca.markets is for broker partners only.)

# -----------------------------------------------------------------------------
# Universe / daily opportunity pool (no need to list individual stocks when using scanner)
# -----------------------------------------------------------------------------
# Set SCREENER_UNIVERSE to define what to scan: lab_12 | sp400 | nasdaq100 | alpaca_equity_500 | file:path/to/symbols.txt
# Tickers come only from the scanner (no static list). Set ACTIVE_SYMBOLS_FILE; scanner runs at container start and 8am ET on full market days.
# SCREENER_UNIVERSE=lab_12
# SCREENER_TOP_N=5
# ACTIVE_SYMBOLS_FILE=data/active_symbols.txt
# OPPORTUNITY_ENGINE_ENABLED=true
# SCREENER_RUN_AT_ET=08:00
# SCREENER_Z_THRESHOLD=2.0
# SCREENER_VOLUME_SPIKE_PCT=15
# SCREENER_LOOKBACK_DAYS=22
# SCREENER_CHUNK_SIZE=100
# SCREENER_CHUNK_DELAY_SEC=0.5

# Brain (closest to data): Go pipes events to this process via stdin. Run from project root.
# BRAIN_CMD="python3 python-brain/apps/consumer.py"

# Optional: strategy tuning. All config in python-brain/brain/config.py; .env overrides.
# Daily cap: no new buys when daily PnL >= target (let winners run; set FLAT_WHEN_DAILY_TARGET_HIT=true to also close all)
# DAILY_PROFIT_TARGET_PCT=0.25
# FLAT_WHEN_DAILY_TARGET_HIT=false
# TAKE_PROFIT_PCT=5.0
# Robustness (forward-looking edge): VOL_MAX_FOR_ENTRY, BREAKEVEN_ACTIVATION_PCT, TRAILING_STOP_*, MAX_HOLD_DAYS
# Three Pillars: Risk First (sizing), Context (regime), Signal (Z/OFI)
# RISK_PCT_PER_TRADE=1.0          # 0.5-2% capital at risk per trade; qty from ATR (Pillar 1)
# KELLY_SIZING_ENABLED=false      # scale risk by Kelly from win rate (quarter-Kelly cap)
# CORRELATION_CHECK_ENABLED=false # reduce size when new position correlated with existing (>0.7)
# REGIME_FILTER_ENABLED=false     # only mean-reversion in choppy regime, trend in trending (Pillar 2)
# Global filter (SPY 200-day MA): when SPY < 200 MA, more cautious on longs (stricter Z, smaller size); favor shorts when added
# SPY_200MA_REGIME_ENABLED=false
# SPY_BELOW_200MA_Z_TIGHTEN=-2.8   # require Z <= this for long when SPY below 200 MA (stricter than -2.5)
# SPY_BELOW_200MA_LONG_SIZE_MULTIPLIER=0.5  # half position size when SPY below 200 MA
# DAILY_DRAWDOWN_CIRCUIT_BREAKER_PCT=5  # pause all trading if daily loss >= 5%
# SCALE_OUT_ENABLED=false        # sell 25% at 1%, 2%, 3%; let runner ride
# SCALE_OUT_LEVELS_PCT=1,2,3
# SCALE_OUT_PCT_PER_LEVEL=25
# POSITION_SIZE_PCT=0.01
# VOL_MAX_FOR_ENTRY=0.55
# BREAKEVEN_ACTIVATION_PCT=1.0
# TRAILING_STOP_ACTIVATION_PCT=2.0
# TRAILING_STOP_PCT=1.0
# MAX_HOLD_DAYS=10
# TAKE_PROFIT_PCT=3.0   # lock in gains at 3% (0=off)
# TREND_FILTER_ENABLED=true   # only long when price > SMA(20)
# TREND_SMA_PERIOD=20
# Technical = RSI + MACD + 3 patterns only (double top, inverted H&S, bull/bear flag)
# USE_TECHNICAL_INDICATORS=true
# RSI_PERIOD=14
# USE_MACD=true
# MACD_FAST=12
# MACD_SLOW=26
# MACD_SIGNAL=9
# USE_PATTERNS=true
# PATTERN_LOOKBACK=40
# Pro mean reversion (defaults): VWAP = fair value; only long when below VWAP; TP at VWAP; 20-period ATR stop 2×; Z < -2.5 + OFI
# USE_ATR_STOP=true           # never fixed % stop — 2.0× ATR below entry (anti-shakeout)
# ATR_PERIOD=20               # 20-period ATR per spec
# ATR_STOP_MULTIPLE=2.0       # exit immediately if price hits this floor
# USE_VWAP_ANCHOR=true        # only long when price significantly below VWAP; primary target = return to VWAP
# VWAP_LONG_ONLY_BELOW=true   # do not enter at VWAP
# TAKE_PROFIT_AT_VWAP=true    # primary profit target = daily VWAP
# BREAKEVEN_AT_HALFWAY_TO_VWAP=true   # at 50% of way to VWAP, move stop to breakeven
# TRAILING_ATR_ABOVE_VWAP=true        # above VWAP: trailing stop at 1.5× ATR below peak (let winners run)
# TRAILING_ATR_MULTIPLE=1.5
# USE_ZSCORE_MEAN_REVERSION=true      # buy trigger when Z <= -2.5 (extreme move)
# ZSCORE_TRIGGER_ENTRY=-2.5
# USE_OFI=true                # after Z met, wait for OFI positive (aggressive buyers)
# OVERNIGHT_CARRY_ENABLED=true # at 4pm close only losers; winners run (trailing ATR / gap-up potential)
# CLOSE_LOSSES_BY_ET=15:50
# ZSCORE_PERIOD=20
# OFI (Order Flow Imbalance) from Alpaca trade/quote stream (Go → brain). Aggressor inferred from trade vs bid/ask.
# USE_OFI=true
# OFI_WINDOW_TRADES=100
# Session: no new buys after 3:45pm ET (positions may be held overnight)
# NO_NEW_BUYS_AFTER_ET=15:45
# USE_LIMIT_ORDERS=true
# LIMIT_ORDER_OFFSET_BPS=5
# DRAWDOWN_HALT_ENABLED=true
# MAX_DRAWDOWN_PCT=2.0

# Backtest accuracy: fill at next bar open (no look-ahead), optional commission/slippage
# BACKTEST_FILL_AT_NEXT_OPEN=true
# BACKTEST_COMMISSION_PER_TRADE=0
# BACKTEST_SLIPPAGE_BPS=0

# How often to fetch positions/orders from Alpaca (seconds, 5–300; default 15 for production-like paper)
# POSITIONS_INTERVAL_SEC=15

# Redis (optional; for replay or other consumers)
# Local: redis://localhost:6379  (start with: docker compose up -d redis)
# Production (Redis Cloud): rediss://default:PASSWORD@host:port
# REDIS_URL=redis://localhost:6379
# REDIS_STREAM=market:updates

# Alpaca Trading API base URL (for positions + open orders; default paper)
# APCA_API_BASE_URL=https://paper-api.alpaca.markets
